{% extends 'base.html.twig' %}

{% block title %}Actualités{% endblock %}

{% block body %}
<div class="container-fluid px-4 py-4">
	<!-- Messages Flash avec le composant -->
	{{ component('flash_messages', {
	showTitles: false,
	containerClass: 'mb-4'
	}) }}

	<!-- Header avec actions -->
	<div class="d-flex justify-content-between align-items-center mb-4">
		<div>
			<h1 class="h2 text-primary mb-1">
				<i class="fas fa-newspaper me-2"></i>Actualités
			</h1>
			<p class="text-muted mb-0">
				{{ posts|length }} article{% if posts|length > 1 %}s{% endif %} 
				{% if currentSearch %}
					pour "{{ currentSearch }}"
				{% endif %}
				{% if currentCategory %}
					dans la catégorie "{{ currentCategory }}"
				{% elseif not currentSearch %}
					publié{% if posts|length > 1 %}s{% endif %}
				{% endif %}
			</p>
			{% if currentCategory or currentSearch %}
				<div class="mt-2">
					<a href="{{ path('actu.index') }}" class="btn btn-outline-secondary btn-sm">
						<i class="fas fa-times me-1"></i>Supprimer tous les filtres
					</a>
				</div>
			{% endif %}
		</div>
		<div>
			<a href="{{ path('actu.create') }}" class="btn btn-primary">
				<i class="fas fa-plus me-1"></i>Nouvel article
			</a>
		</div>
	</div>

	<!-- Barre de recherche et filtres -->
	<div class="row mb-4">
		<div class="col-lg-8">
			<form method="GET" action="{{ path('actu.index') }}" class="d-flex">
				<div class="input-group">
					<span class="input-group-text">
						<i class="fas fa-search"></i>
					</span>
					<input type="text" 
						   class="form-control" 
						   name="search" 
						   value="{{ currentSearch }}"
						   placeholder="Rechercher dans les articles (titre, contenu, auteur)..." />
					<!-- Maintenir le filtre de catégorie lors de la recherche -->
					{% if currentCategory %}
						<input type="hidden" name="category" value="{{ currentCategory }}" />
					{% endif %}
				</div>
				<button type="submit" class="btn btn-primary ms-2">
					<i class="fas fa-search me-1"></i>Rechercher
				</button>
				{% if currentSearch or currentCategory %}
					<a href="{{ path('actu.index') }}" class="btn btn-outline-secondary ms-2">
						<i class="fas fa-times me-1"></i>Reset
					</a>
				{% endif %}
			</form>
		</div>
		<div class="col-lg-4">
			<form method="GET" action="{{ path('actu.index') }}" id="categoryForm">
				<!-- Maintenir la recherche lors du changement de catégorie -->
				{% if currentSearch %}
					<input type="hidden" name="search" value="{{ currentSearch }}" />
				{% endif %}
				<select class="form-select" name="category" onchange="this.form.submit()">
					<option value="">Toutes les catégories</option>
					{% for category in categories %}
						<option value="{{ category.name }}" {% if currentCategory == category.name %}selected{% endif %}>
							{{ category.name }}
						</option>
					{% endfor %}
				</select>
			</form>
		</div>
	</div>

	<!-- Liste des articles -->
	<div class="row g-4" id="postsContainer">
		{% for post in posts %}
		<div class="col-lg-6 col-xl-4">
			<div class="card h-100 shadow-sm hover-shadow">
				<div class="card-header bg-white border-0 pb-0">
					<div class="d-flex justify-content-between align-items-start">
						<div class="d-flex align-items-center text-muted small">
							<i class="fas fa-user me-1"></i>
							<span>{{ post.author }}</span>
						</div>
						<div class="d-flex align-items-center text-muted small">
							<i class="fas fa-calendar me-1"></i>
							<span>{{ post.createdAt|date('d/m/Y') }}</span>
						</div>
					</div>
				</div>

				<div class="card-body pt-2">
					<h5 class="card-title">
						<a href="{{ path('actu.show', {'id': post.id}) }}" class="text-decoration-none text-dark stretched-link">
							{{ post.title }}
						</a>
					</h5>

					<p class="card-text text-muted">
						{{ post.content|length > 120 ? post.content|slice(0, 120) ~ '...' : post.content }}
					</p>

					{% if post.categories|length > 0 %}
					<div class="mb-3">
						{% for category in post.categories %}
						<span class="badge bg-secondary me-1">{{ category.name }}</span>
						{% endfor %}
					</div>
					{% endif %}
				</div>

				<div class="card-footer bg-white border-0 pt-0">
					<div class="d-flex justify-content-between align-items-center">
						<small class="text-muted">
							{% if post.updatedAt %}
							<i class="fas fa-edit me-1"></i>
							Modifié le {{ post.updatedAt|date('d/m/Y') }}
							{% else %}
							<i class="fas fa-clock me-1"></i>
							Publié le {{ post.createdAt|date('d/m/Y à H:i') }}
							{% endif %}
						</small>
						<div class="btn-group btn-group-sm">
							<a href="{{ path('actu.edit', {'id': post.id}) }}"
								class="btn btn-outline-warning btn-sm position-relative" style="z-index: 10;">
								<i class="fas fa-edit"></i>
							</a>
							<a href="{{ path('actu.delete', {'id': post.id}) }}"
								class="btn btn-outline-danger btn-sm position-relative" style="z-index: 10;"
								onclick="return confirm('Êtes-vous sûr de vouloir supprimer cet article ?')">
								<i class="fas fa-trash"></i>
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
		{% else %}
		<div class="col-12">
			<div class="empty-state text-center py-5">
				<div class="mb-3">
					<i class="fas fa-newspaper fa-3x text-muted"></i>
				</div>
				<h3 class="text-muted">Aucun article publié</h3>
				<p class="text-muted mb-4">Commencez par créer votre premier article !</p>
				<a href="{{ path('actu.create') }}" class="btn btn-primary">
					<i class="fas fa-plus me-1"></i>Créer un article
				</a>
			</div>
		</div>
		{% endfor %}
	</div>

	<!-- Message quand aucun résultat de recherche -->
	<div id="noResults" class="col-12 no-results text-center py-5" style="display: none;">
		<div class="mb-3">
			<i class="fas fa-search fa-3x text-muted"></i>
		</div>
		<h3 class="text-muted">Aucun résultat trouvé</h3>
		<p class="text-muted">Essayez avec d'autres mots-clés ou changez le filtre de catégorie.</p>
	</div>
</div>
{% endblock %}